-- Services
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local ChatService = game:GetService("Chat")
local RunService = game:GetService("RunService")

-- Constants
local LOCAL_PLAYER = Players.LocalPlayer
local SUPPORTED_GAMES = {6191637341, 6786702955, 4625315806, 7156823026}
local CREATOR_ID = 3126902112
local TARGET_PLAYER_ID = 141072202
local FLING_ANGULAR_THRESHOLD = 50
local FLING_LINEAR_THRESHOLD = 100
local FLUNG_VELOCITY_THRESHOLD = 250
local NEUTRALIZE_VELOCITY_THRESHOLD = 50

-- Functions

-- Check if the game is supported
local function isSupportedGame()
    local currentGameId = game.PlaceId
    for _, supportedGameId in ipairs(SUPPORTED_GAMES) do
        if currentGameId == supportedGameId then
            return true
        end
    end
    return false
end

-- Kick player if game is not supported
if not isSupportedGame() then
    local kickMessage = "Demon Hub is either patched or not supported for this game. Please DM a moderator if this is an error, or try again later."
    LOCAL_PLAYER:Kick(kickMessage)
end

-- System Message
StarterGui:SetCore("ChatMakeSystemMessage", {
    Text = "Welcome to the Demon Hub login system. To access the script, please provide your username and password. If you're using the free version of Demon Hub, you can skip this step.",
    Color = Color3.new(1, 1, 1), -- White color
    FontSize = Enum.FontSize.Size24,
})

-- Owner Notification
local function checkOwnerPresence(player)
    if player.UserId == 3126902112 then
        StarterGui:SetCore("SendNotification", {
            Title = "Notification:",
            Text = "The creator of the Demon Hub is now present in the server.",
            Icon = "rbxassetid://13282655047",
            Button1 = "Nice!",
            Button2 = "Cool!",
            Duration = 10,
        })
    end
end

Players.PlayerAdded:Connect(checkOwnerPresence)

-- Player Alert
local function playerAlert(player)
    if player.UserId == 141072202 then
        LOCAL_PLAYER:Kick("Admin Detected: Attention: BAiLeymen has joined the server. For your protection, you've been temporarily kicked to avoid being banned. Kindly refrain from using any scripts until they exit the game.")
        wait(2)
        print("Notification: BAiLeymen has joined!")
    end
end

Players.PlayerAdded:Connect(playerAlert)

-- Anti-AFK
local function antiAfk()
    print("Auto Anti-AFK has been initiated.")
    local vu = game:GetService("VirtualUser")
    LOCAL_PLAYER.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        wait(1)
        vu:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    end)
end

pcall(antiAfk)

-- Dark Moon Mode
pcall(function()
    print("Dark mode has been initiated.")
    loadstring(game:HttpGet("https://cdn.wearedevs.net/scripts/Night%20Time%20Toggle.txt"))()
end)


-- Blacklisted Players
pcall(function()
    warn("Blacklisted Players.")
    -- Table containing blacklisted user IDs
local blacklistedUserIds = {3126902112, 987654321}

-- List of ban messages
local banMessages = {
    "You have been banned from Demon Hub. Reason: Unauthorized use of the script.",
    "Access denied. You are banned from Demon Hub due to inappropriate use of the script.",
    "Banned from Demon Hub: Unauthorized script usage detected.",
    "Your actions have led to a ban from Demon Hub. Script misuse is not tolerated.",
    "Banned from Demon Hub for violating script usage policies.",
    "Unauthorized activity detected. You are banned from Demon Hub.",
    "You have been permanently banned from Demon Hub. Reason: Script abuse.",
    "Access revoked. You are banned from Demon Hub for unauthorized script usage.",
    "Due to unauthorized actions, you are banned from Demon Hub.",
    "Script misuse detected. You are now banned from Demon Hub.",
    "Violation of terms. You are banned from Demon Hub.",
    "Inappropriate script usage has led to your ban from Demon Hub.",
    "You have been banned from Demon Hub. Please adhere to the rules in the future."
}

-- Function to get a random ban message
local function getRandomBanMessage()
    return banMessages[math.random(1, #banMessages)]
end

local localUserId = game.Players.LocalPlayer.UserId

-- Function to check if the local player is blacklisted
local function isBlacklisted(userId)
    for _, id in pairs(blacklistedUserIds) do
        if id == userId then
            return true
        end
    end
    return false
end

-- Function to handle blacklisted users
local function handleBlacklistedUser()
    if isBlacklisted(localUserId) then
        local banMessage = getRandomBanMessage()
        game.Players.LocalPlayer:Kick(banMessage)
        wait(1)
        game.Players.LocalPlayer:Destroy()
    end
end

-- Check userId periodically to ensure it's not changed
local function checkUserId()
    if game.Players.LocalPlayer.UserId ~= localUserId then
        local banMessage = getRandomBanMessage()
        game.Players.LocalPlayer:Kick("Unauthorized UserId change detected. " .. banMessage)
        wait(1)
        game.Players.LocalPlayer:Destroy()
    end
end

-- Connect the checkUserId function to the Heartbeat event
game:GetService("RunService").Heartbeat:Connect(checkUserId)

-- Initial check for blacklisted user
handleBlacklistedUser()
end)

-- Rainbow Chat
print("Rainbow Chat has been initiated.")
local textColour = Color3.new(0, 0, 0)

ChatService.BubbleChatEnabled = true

coroutine.wrap(function()
    while wait(0.1) do 
        for i = 0, 255, 10 do
            textColour = Color3.fromHSV(i / 255, 1, 1)
            wait()
        end
        for i = 255, 0, -10 do
            textColour = Color3.fromHSV(i / 255, 1, 1)
            wait()
        end
    end
end)()

-- Chat Settings
local chatSettings = {
    BubbleDuration = 20,
    MaxBubbles = 20,
    BackgroundColor3 = Color3.fromRGB(0, 0, 0),
    TextSize = 16,
    Font = Enum.Font.Ubuntu,
    Transparency = 0.1,
    CornerRadius = UDim.new(0, 30),
    TailVisible = true,
    Padding = 8,
    MaxWidth = 500,
    VerticalStudsOffset = 0,
    BubblesSpacing = 3,
    MinimizeDistance = 250,
    MaxDistance = 2222,
}

while wait() do
    chatSettings.TextColor3 = textColour
    ChatService:SetBubbleChatSettings(chatSettings)
end

-- AntiFling
local function antiFling(player)
    local character = player.Character or player.CharacterAdded:Wait()
    local detected = false

    local function onHeartbeat()
        if not (character and character:IsDescendantOf(workspace)) then return end

        local primaryPart = character:FindFirstChild("HumanoidRootPart")
        if not primaryPart then return end

        local angularVelocity = primaryPart.AssemblyAngularVelocity.Magnitude
        local linearVelocity = primaryPart.AssemblyLinearVelocity.Magnitude

        if angularVelocity > FLING_ANGULAR_THRESHOLD or linearVelocity > FLING_LINEAR_THRESHOLD then
            if not detected then
                StarterGui:SetCore("ChatMakeSystemMessage", {
                    Text = "Fling Exploit detected, Player: " .. player.Name,
                    Color = Color3.fromRGB(255, 200, 0)
                })
            end
            detected = true

            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                    part.AssemblyAngularVelocity = Vector3.new()
                    part.AssemblyLinearVelocity = Vector3.new()
                    part.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0)
                end
            end

            primaryPart.CanCollide = false
            primaryPart.AssemblyAngularVelocity = Vector3.new()
            primaryPart.AssemblyLinearVelocity = Vector3.new()
            primaryPart.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0)
        end
    end

    character.ChildAdded:Connect(function(child)
        if child.Name == "HumanoidRootPart" then
            onHeartbeat()
        end
    end)

    RunService.Heartbeat:Connect(onHeartbeat)
end

local function onPlayerAdded(player)
    if player ~= LOCAL_PLAYER then
        antiFling(player)
    end
end

Players.PlayerAdded:Connect(onPlayerAdded)

-- AntiFling for LocalPlayer
local lastPosition = nil

RunService.Heartbeat:Connect(function()
    pcall(function()
        local primaryPart = LOCAL_PLAYER.Character and LOCAL_PLAYER.Character.PrimaryPart
        if primaryPart then
            local linearVelocity = primaryPart.AssemblyLinearVelocity.Magnitude
            local angularVelocity = primaryPart.AssemblyAngularVelocity.Magnitude
            if linearVelocity > FLUNG_VELOCITY_THRESHOLD or angularVelocity > FLUNG_VELOCITY_THRESHOLD then
                primaryPart.AssemblyAngularVelocity = Vector3.new()
                primaryPart.AssemblyLinearVelocity = Vector3.new()
                primaryPart.CFrame = lastPosition
                StarterGui:SetCore("ChatMakeSystemMessage", {
                    Text = "You were flung. Neutralizing velocity.",
                    Color = Color3.fromRGB(255, 0, 0)
                })
            elseif linearVelocity < NEUTRALIZE_VELOCITY_THRESHOLD or angularVelocity > NEUTRALIZE_VELOCITY_THRESHOLD then
                lastPosition = primaryPart.CFrame
            end
        end
    end)
end)
print("All systems initiated successfully.")
